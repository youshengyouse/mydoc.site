{"version":3,"file":"lru-cache.js","sources":["../../src/lru-cache.ts"],"sourcesContent":["export type LRUCache<TKey, TValue> = {\n  get: (key: TKey) => TValue | undefined\n  set: (key: TKey, value: TValue) => void\n}\n\nexport function createLRUCache<TKey, TValue>(\n  max: number,\n): LRUCache<TKey, TValue> {\n  type Node = { prev?: Node; next?: Node; key: TKey; value: TValue }\n  const cache = new Map<TKey, Node>()\n  let oldest: Node | undefined\n  let newest: Node | undefined\n\n  const touch = (entry: Node) => {\n    if (!entry.next) return\n    if (!entry.prev) {\n      entry.next.prev = undefined\n      oldest = entry.next\n      entry.next = undefined\n      if (newest) {\n        entry.prev = newest\n        newest.next = entry\n      }\n    } else {\n      entry.prev.next = entry.next\n      entry.next.prev = entry.prev\n      entry.next = undefined\n      if (newest) {\n        newest.next = entry\n        entry.prev = newest\n      }\n    }\n    newest = entry\n  }\n\n  return {\n    get(key) {\n      const entry = cache.get(key)\n      if (!entry) return undefined\n      touch(entry)\n      return entry.value\n    },\n    set(key, value) {\n      if (cache.size >= max && oldest) {\n        const toDelete = oldest\n        cache.delete(toDelete.key)\n        if (toDelete.next) {\n          oldest = toDelete.next\n          toDelete.next.prev = undefined\n        }\n        if (toDelete === newest) {\n          newest = undefined\n        }\n      }\n      const existing = cache.get(key)\n      if (existing) {\n        existing.value = value\n        touch(existing)\n      } else {\n        const entry: Node = { key, value, prev: newest }\n        if (newest) newest.next = entry\n        newest = entry\n        if (!oldest) oldest = entry\n        cache.set(key, entry)\n      }\n    },\n  }\n}\n"],"names":[],"mappings":"AAKO,SAAS,eACd,KACwB;AAElB,QAAA,4BAAY,IAAgB;AAC9B,MAAA;AACA,MAAA;AAEE,QAAA,QAAQ,CAAC,UAAgB;AACzB,QAAA,CAAC,MAAM,KAAM;AACb,QAAA,CAAC,MAAM,MAAM;AACf,YAAM,KAAK,OAAO;AAClB,eAAS,MAAM;AACf,YAAM,OAAO;AACb,UAAI,QAAQ;AACV,cAAM,OAAO;AACb,eAAO,OAAO;AAAA,MAAA;AAAA,IAChB,OACK;AACC,YAAA,KAAK,OAAO,MAAM;AAClB,YAAA,KAAK,OAAO,MAAM;AACxB,YAAM,OAAO;AACb,UAAI,QAAQ;AACV,eAAO,OAAO;AACd,cAAM,OAAO;AAAA,MAAA;AAAA,IACf;AAEO,aAAA;AAAA,EACX;AAEO,SAAA;AAAA,IACL,IAAI,KAAK;AACD,YAAA,QAAQ,MAAM,IAAI,GAAG;AACvB,UAAA,CAAC,MAAc,QAAA;AACnB,YAAM,KAAK;AACX,aAAO,MAAM;AAAA,IACf;AAAA,IACA,IAAI,KAAK,OAAO;AACV,UAAA,MAAM,QAAQ,OAAO,QAAQ;AAC/B,cAAM,WAAW;AACX,cAAA,OAAO,SAAS,GAAG;AACzB,YAAI,SAAS,MAAM;AACjB,mBAAS,SAAS;AAClB,mBAAS,KAAK,OAAO;AAAA,QAAA;AAEvB,YAAI,aAAa,QAAQ;AACd,mBAAA;AAAA,QAAA;AAAA,MACX;AAEI,YAAA,WAAW,MAAM,IAAI,GAAG;AAC9B,UAAI,UAAU;AACZ,iBAAS,QAAQ;AACjB,cAAM,QAAQ;AAAA,MAAA,OACT;AACL,cAAM,QAAc,EAAE,KAAK,OAAO,MAAM,OAAO;AAC3C,YAAA,eAAe,OAAO;AACjB,iBAAA;AACL,YAAA,CAAC,OAAiB,UAAA;AAChB,cAAA,IAAI,KAAK,KAAK;AAAA,MAAA;AAAA,IACtB;AAAA,EAEJ;AACF;"}